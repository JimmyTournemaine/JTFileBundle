{% extends "::base.html.twig" %}

{% block title %}MapsBundle:Maps:index{% endblock %}
{% block meta_tags %}<meta name="viewport" content="initial-scale=1.0">{% endblock %}
{% block container %}
<div id="map"></div>
{% endblock %}

{% block stylesheets %}
	<style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { min-height: 80%; }

    </style>
{% endblock %}

{% block javascripts %}
<script type="text/javascript">
	function drop() {
	  for (var i =0; i < markerArray.length; i++) {
	    setTimeout(function() {
	      addMarkerMethod();
	    }, i * 200);
	  }
	}
    function initMap() {
    	var directionsDisplay = new google.maps.DirectionsRenderer;
    	var directionsService = new google.maps.DirectionsService;
    	var map = new google.maps.Map(document.getElementById('map'), {
    	   center: {lat: 48.390, lng: -4.486},
    	   zoom: 12
    	});
    	directionsDisplay.setMap(map);
    	// Try HTML5 geolocation.
    	if (navigator.geolocation) {
    	  navigator.geolocation.getCurrentPosition(function(position) {
    	    var pos = {
    	      lat: position.coords.latitude,
    	      lng: position.coords.longitude
    	    };
    	    map.setCenter(pos);
    	  }, function() {
    	    handleLocationError(true, infoWindow, map.getCenter());
    	  });
    	} else {
    	  // Browser doesn't support Geolocation
    	  handleLocationError(false, infoWindow, map.getCenter());
    	}
    	var marker = new google.maps.Marker({
        	position: {lat: 48.390, lng: -4.486},
            animation: google.maps.Animation.DROP,
        	title: 'Hello World',
            icon: "{{ asset('bundles/maps/images/marker_blue.png') }}"});
    	marker.setMap(map);

    	var request = {
        	origin: {
            	lat: 48.390,
               	lng: -4.486
            },
           	destination: {lat: 48.330, lng: -4.446},
           	travelMode: google.maps.TravelMode.DRIVING,
           	drivingOptions: {
           		  departureTime: new Date(),
           		  trafficModel: google.maps.TrafficModel.BEST_GUESS
           	},
           	waypoints: [{location:{lat: 48.370, lng: -4.426},stopover:true},{location:{lat: 48.380, lng: -4.416},stopover:true}],
           	optimizeWaypoints: false,
           	provideRouteAlternatives: true
        };
        directionsService.route(request, function(result, status) {
            if (status == google.maps.DirectionsStatus.OK) {
            	directionsDisplay.setDirections(result);
        	} else {
            	window.alert('Failed due to ' + status);
            }
        });
    }
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    	  alert(browserHasGeolocation ?
          	'Error: The Geolocation service failed.' :
          	'Error: Your browser doesn\'t support geolocation.');
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?callback=initMap&signed_in={{ sign_in }}&key={{ google_api_key }}" async defer></script>
{% endblock %}
